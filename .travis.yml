---
sudo: true
language: go

addons:
  apt:
    packages:
      - xvfb
      - figlet
      - toilet

install:
  - export DISPLAY=':99'
  - sudo apt-get install openjdk-7-jre-headless
  - Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
  - sudo apt-get update
  #- wget https://apt.puppetlabs.com/puppetlabs-release-trusty.deb
  #- sudo dpkg --force-all -i puppetlabs-release-trusty.deb
  - sudo apt-get -y install ntp
  - sudo apt-get update
  - sudo apt-get install puppetmaster
  - sudo apt-get update
  - sudo apt-get install puppet
  #- sudo puppet resource package puppetmaster ensure=latest
  - sudo puppet resource service puppetmaster ensure=running enable=true
  - sudo puppet agent
  - sudo timedatectl set-timezone America/New_York
  
script:
  - export PDIR=/home/travis/.puppet
  #- export TZ='America/New_York'
  - export ROOT_DIR=`pwd`
  - toilet -f mono12 `date '+%y-%m-%d%n%H.%M'`
  - cat /etc/*-release 
  - ps -ef | egrep puppet
  - ps -ef | egrep docker
  - cat /etc/passwd
  - sudo netstat -tunpl
  - env | sort
  
  - sudo sh -c $ROOT_DIR/bin/deploy_puppet
  - sudo sh -c $ROOT_DIR/bin/deploy_root
  
  - sudo puppet apply -e 'file { "/tmp/adhoc": content => "Written from puppet on ${::hostname}\n" }'
  - sudo cat /tmp/adhoc
  - echo Done
